## 標準添付ライブラリ

[Ruby技術者認定試験の書籍写経メモ]({% post_url 2017-07-22-Ruby技術者認定試験の書籍写経メモ %})

- 標準添付ライブラリはRubyに付属しているライブラリ
- 組み込みライブラリと違う点はrequire等でライブラリをロードする必要がある
- Ruby技術者認定試験の出題範囲はGold

```ruby
pp []
=> NoMethodError: undefined method 'pp'

require 'pp'
=> true

pp []
[]
=> []
```

### tringIO

- 文字列をIOクラスと同じインターフェイスで取り扱う為のクラス
- IOクラスとの継承関係はないオブジェクト内のバッファに文字列を格納したり取り出したりする

#### バッファとポインタ

あれ？（少なくとも）Ruby2.4ではrequireしなくても使えたわ

| バッファ | StringIO#string | デフォは "" |
| ポインタ | StringIO#pos    | デフォは 0  |

```ruby
sio = StringIO.new
=> #<StringIO:0x007fdf310478c0>

sio.string
=> ""

sio.pos
=> 0
```

#### StringIO#puts

- 引数の文字列をバッファへ格納し、ポインタを移動する
- 格納されるバッファには改行が付加される（put系ぽい）
- ポインタはバッファ上にて追加された文字列と改行の後に移動する

```ruby
sio = StringIO.new
=> #<StringIO:0x007fdf310478c0>

sio.puts('Hello')
=> nil

sio.string
=> "Hello\n"

sio.pos
=> 6
```

#### StringIO#gets

- 現在のポインタから改行（もしくは末尾）までの文字列を返し、ポインタを移動する
- 返される文字列には改行が付加される（put系ぽい）
- ポインタはバッファ上にて、返した文字列と改行の後に移動する

```ruby
sio = StringIO.new
=> #<StringIO:0x007fdf310478c0>

sio.puts('AB')
sio.puts('CD')

sio.string
=> "AB\nCD\n"

sio.pos
=> 6

sio.gets
=> nil

sio.pos = 0

sio.gets
=> "AB\n"

sio.pos
=> 3
```

#### インスタンス生成時の初期値

```ruby
StringIO.new(string = '', mode = 'r+')
StringIO.open(string = '', mode = 'r+')
StringIO.open(string = '', mode = 'r+') { |sio| ... }
```

#### mode r

- 読み込みモード
- ポインタは先頭を指す

```ruby
StringIO.open('test', 'r') do |sio|
  p "string:#{sio.string}, pos:#{sio.pos}"
  sio.puts('a')
  #=> IOError: not opened for writing
end
=> "string:test, pos:0"
```

#### mode w

- 書き込みモード
- バッファは空になる
- 当然ポインタは先頭

```ruby
StringIO.open('test', 'w') do |sio|
  p "string:#{sio.string}, pos:#{sio.pos}"
  p sio.gets
  #=> IOError: not opened for reading
end
=> "string:, pos:0"
```

#### mode a

- 書き込みモード
- ポインタは末尾を指す
- ・・ポインタは末尾じゃなくて0を指しているように見えるけど、putsしたら末尾に出力するし、ポインタも末尾に移動したんでまぁいいか

```ruby
StringIO.open('test', 'a') do |sio|
  p "string:#{sio.string}, pos:#{sio.pos}"
  sio.puts('AB')
  p "string:#{sio.string}, pos:#{sio.pos}"
end
=> "string:, pos:0"
=> "string:testAB\n, pos:7"
```

#### mode r+

- 読み書きモード
- ポインタは先頭を指す

```ruby
StringIO.open('test', 'r+') do |sio|
  p "string:#{sio.string}, pos:#{sio.pos}"
  sio.puts('AB')
  p "string:#{sio.string}, pos:#{sio.pos}"
end
=> "string:test, pos:0"
=> "string:AB\nt, pos:3"
```

#### mode w+

- 読み書きモード
- バッファは空になる

```ruby
StringIO.open('test', 'w+') do |sio|
  p "string:#{sio.string}, pos:#{sio.pos}"
end
=> "string:, pos:0"
```

#### mode a+

- 読み書きモード
- ポインタは末尾を指す
- ・・ポインタは末尾じゃなくて0を指しているように見えるけど、putsしたら末尾に出力するし、ポインタも末尾に移動したんでまぁいいか

```ruby
StringIO.open('test', 'a+') do |sio|
  p "string:#{sio.string}, pos:#{sio.pos}"
  sio.puts('AB')
  p "string:#{sio.string}, pos:#{sio.pos}"
end
```
=> "string:test, pos:0"
=> "string:testAB\n, pos:7"
