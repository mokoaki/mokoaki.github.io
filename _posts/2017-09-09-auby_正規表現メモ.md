Rubyの正規表現的なあとでやくにたつかな〜メモ

#### 正規表現パターン

| .     | 改行を除く任意の1文字（ただしmオプションを指定した時には改行もマッチ） |
| \d    | [0-9]                                                                  |
| \D    | \d以外                                                                 |
| \w    | [a-z][A-Z][0-9]                                                        |
| \W    | \w以外                                                                 |
| \s    | 空白文字、\t, \n, \r, \f 等                                            |
| \S    | \s以外                                                                 |
| \A    | データ先頭                                                             |
| \z    | データ末尾                                                             |
| \Z    | データ末尾が改行で終わっていればその直前                               |
| *     | 0回以上の繰り返し                                                      |
| +     | 1回以上の繰り返し                                                      |
| {m}   | m回の繰り返し                                                          |
| {m,}  | 最低m回の繰り返し                                                      |
| {m,n} | 最低m回、最高n回の繰り返し                                             |
| ()    | グループ化、キャプチャ（後方参照）                                     |

オプション

| //i   | 大文字小文字の区別をしない                               |
| //o   | 一度だけ式展開を行う                                     |
| //x   | パターン中の空白と改行を無視、＃以降はコメントとして無視 |
| //m   | マルチラインモード                                       |

#### 文字列の末尾の改行を消す

string#chompは頭おかしい挙動するのであんまり使いたくない

```ruby
# 引数なし => 消す対象は [\r, \n, \r\n] だが、1つしか消してくれない
" abc \n abc \r\r\n\n".chomp
=> " abc \n abc \r\r\n"

# 引数が空文字 => 複数消してくれるけど、消す対象は [/n, \r\n] だけ
" abc \n abc \r\r\n\n".chomp('')
=> " abc \n abc \r"
```

- おとなしく string#gsub した方がいいと思う
- \R => (?>\x0D\x0A\|[\x0A-\x0D\x{85}\x{2028}\x{2029}]) （ぐぐる）

```ruby
" abc \n abc \r\r\n".gsub(/\R+\z/, '')
=> " abc \n abc "
```

下記の [:space:] も使えると思う

#### 全角半角のstrip

string#strip は半角だけが対象なんであんまり使いたくない・・

```ruby
' 　moko　 '.strip
=> "　moko　"
```

POSIX 文字クラス

| [:blank:] | スペースとタブ (Space_Separator, 0009)                                                                            |
| [:space:] | 空白、改行、復帰、タブ (Space_Separator, Line_Separator, Paragraph_Separator, 0009, 000A, 000B, 000C, 000D, 0085) |
| 他にも    | いっぱいある                                                                                                      |

```ruby
" 　\t moko \t 　 ".gsub(/\A[[:blank:]]+|[[:blank:]]+\z/, '')
=> "moko"

" 　\n\r \t moko \t \r\n　 ".gsub(/\A[[:space:]]+|[[:space:]]+\z/, '')
=> "moko"
```

文字列の先頭、末尾以外も消したいならもちろんこんなかんじ

```ruby
" 　\n\r \t mo 　 \t \r \r\n \n \t 　 ko \t \r\n　 ".gsub(/[[:space:]]+/, '')
=> "moko"
```

#### メアドにマッチ

- メアドにマッチする完全な正規表現は現実的に無理（詳細はぐぐる）
- なので、常識的なメアドならほぼイケるだろう、という感じの正規表現を使う
- 最近流行りのナウいトップレベルドメインは3文字以上ならおｋらしい　既存では2文字があるから2文字以上とする
- \w => [a-zA-Z0-9]

```ruby
mail = 'Hoge.Hoge_Hoge-Hoge+alias@Hoge_Hoge.Hoge-Hoge.HogeHoge'

mail.match?(/\A[\w+._-]+@[\w._-]+[a-zA-Z]{2,}\z/)
=> true
```
