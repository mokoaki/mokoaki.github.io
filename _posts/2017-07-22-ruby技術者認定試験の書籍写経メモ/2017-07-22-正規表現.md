## 正規表現 Regexp

[Ruby技術者認定試験の書籍写経メモ]({% post_url 2017-07-22-ruby技術者認定試験の書籍写経メモ %})

### 作り方

```ruby
/moko/             #=> /moko/
%r(moko)           #=> /moko/
Regexp.new('moko') #=> /moko/
```

### やっぱきた、=== メソッド

```ruby
# Regexp#=== は正規表現マッチするかどうかを真偽値で返す
/moko/ === 'I am moko.'
#=> true

/moko/ === 'I am homo.'
#=> false

# ところで、=== といえば case式ですね
case 'I am moko.'
when /moko/
  p 'moko!'
when /homo/
  p 'homo!'
end
"moko!"
=> "moko!"
```

### =~ メソッド

```ruby
# Regexp#=~ は正規表現マッチした場所のindexを返す
/moko/ =~ 'I am moko.'
#=> 5

# マッチしなかったらnil
/moko/ =~ 'I am homo.'
#=> nil

# Stringクラスでも定義されてる！
'I am moko.' =~ /moko/
#=> 5
'I am homo.' =~ /moko/
#=> nil
```

### 正規表現記号まとめ ruby

- Javascriptのはココにまとめたんだけど・・またやるか
- https://gist.github.com/mokoaki/9a64b36f32ca42c80d4c1d76b26e987e

| 正規表現記号 | 意味 |
| --- | --- |
| . | 改行を除く任意の1文字（ただしmオプションを指定した時には改行もマッチ） |
| \d | [0-9] |
| \D | \d以外 |
| \w | [a-z][A-Z][0-9] |
| \W | \w以外 |
| \s | 空白文字、\t, \n, \r, \f 等 |
| \S | \s以外 |
| \A | データ先頭 |
| \z | データ末尾 |
| \Z | データ末尾が改行で終わっていればその直前 |
| * | 0回以上の繰り返し |
| + | 1回以上の繰り返し |
| {m} | m回の繰り返し |
| {m,} | 最低m回の繰り返し |
| {m,n} | 最低m回、最高n回の繰り返し |
| () | グループ化、キャプチャ（後方参照） |
| //i | 大文字小文字の区別をしない |
| //o | 一度だけ式展開を行う |
| //x | パターン中の空白と改行を無視、＃以降はコメントとして無視 |
| //m | マルチラインモード |

### 正規表現の特殊変数覚えてる？

- 特殊変数の一覧は上の方に書いてあるんで
- あれ？組み込み変数って言ってる人もいる・・どっちやねん
- 特に `&' の3つは英字キーボードでもこんな感じの並びなので覚えやすいか？？

```ruby
/bb/ === 'aabbcc'
$` #=> "aa" # マッチ箇所より前
$& #=> "bb" # マッチ箇所
$' #=> "cc" # マッチ箇所より後
```

```ruby
# キャプチャ後方参照もいじってみる
/(a|b)1.*(?:c|d)1.*(e|f)1/ === 'ab1 c1d e1f'
$+ #=> "e"
$1 #=> "b"
$2 #=> "e"
$3 #=> nil
```

```ruby
# オプションもちょっといじってみる
/moko/  === 'I AM MOKO.' #=> false
/moko/i === 'I AM MOKO.' #=> true

/a.*b/  === "a \n b" #=> false
/a.*b/m === "a \n b" #=> true
```
