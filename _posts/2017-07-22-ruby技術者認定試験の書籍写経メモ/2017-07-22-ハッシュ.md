## ハッシュ

[Ruby技術者認定試験の書籍写経メモ]({% post_url 2017-07-22-ruby技術者認定試験の書籍写経メモ %})

- いわゆる連想配列
- 1.9からハッシュに含まれる要素の順番が追加された順序で保持されるようになった

### ハッシュの生成

ハッシュのキーには任意のオブジェクトが使えるが、シンボルがよく使われる。理由は後述

#### リテラル

旧記法

```ruby
{:a => 1}
=> {:a=>1}

{:a => 1}.class
=> Hash
```

1.9からの新記法

```ruby
{a: 1}
=> {:a=>1}

{a: 1}.class
=> Hash
```

2.2からの新記法

```ruby
{'a': 1, 'b-c': 2}
=> {:a=>1, :"b-c"=>2}

{'a': 1, 'b-c': 2}.class
=> Hash
```

#### Hash.[] メソッド

この方法は積極的に使う理由がない限り使う必要は無いでしょう

```ruby
Hash[1, 2, 3, 4]
=> {1=>2, 3=>4}
```

#### Hash.new メソッド

newメソッドを使用した場合、キーが存在しない場合のデフォルト値を設定できます　がぶっちゃけ使いません

```ruby
h = Hash.new('test')

h.class
=> Hash

h[:hage]
=> '"test"'
```

初期値はハッシュ作成後でも変更できる

```ruby
h = Hash.new('test')

h.default
=> "test"
```

```ruby
h = {}

h[:hage]
=> nil

h.default
=> nil

h.default = 'test'

h.default
=> 'test'

h[:hage]
=> 'test'
```

- newメソッドはブロックを取ることができる
- このブロックは新規キーを読み取り参照した時に処理される

```ruby
h = Hash.new do |hash, key|
  p '= access new key'
  p hash, key

  hash[key] = (key == :hage1 ? 'a' : 'b')
end

h.class
=> Hash

h[:hage1]
"= access new key"
{}
:hage1
=> "a"

h[:hage1]
=> "a"

h[:hage2]
"= access new key"
{:hage1=>"a"}
:hage2
=> "b"

h[:hage2]
=> "b"

h[:hage3]
"= access new key"
{:hage1=>"a", :hage2=>"b"}
:hage3
=> "b"

h[:hage3]
=> "b"
```

参照ではなく、keyとvalueの新規設定時には動作しない。動作する必要もないし

```ruby
h = Hash.new do |hash, key|
  p '= access new key'
  p hash, key

  hash[key] = (key == :hage1 ? 'a' : 'b')
end

h.class
=> Hash

h[:hage1] = 'hage-!'
=> "hage-!"
```

- この初期値設定ブロックは Hash#default_proc で後から参照できる
- まぁいじる事は無いと思うけど・・

```ruby
h = Hash.new do |hash, key|
  hash[key] = (key == :hage1 ? 'a' : 'b')
end

h.class
=> Hash

h.default_proc
=> #<Proc:0x007fcaa10af730@(irb):77>
```

#### Array#to_h

ぶっちゃけ使わないけど

```ruby
[[:a, 1], ['b', 2]].to_h
=> {:a=>1, "b"=>2}
```













------------------------------



### メソッド呼び出し時の実引数の波カッコの省略

- ぶっちゃけ使わないかな？
- 最後の引数だけ有効

```ruby
def moko(a, b, c)
  p a
  p b
  p c
end

moko(1, 2, a: 1, 'b' => 2)
1
2
{:a=>1, "b"=>2}
=> {:a=>1, "b"=>2}

# 引数の数的に考えて、残りの部分がハッシュとして解釈できそうなら、
moko(1, 2, { a: 1, 'b' => 2 })
# こう書いたかの如く動作するよ！って事だわな

```

[キーワード引数]({% post_url 2017-07-22-クラス、オブジェクト指向、メソッド探索経路 %}#キーワード引数) も併せて理解しておくべし
