## Module クラス

[Ruby技術者認定試験の書籍写経メモ]({% post_url 2017-07-22-ruby技術者認定試験の書籍写経メモ %})

### 機能をひとまとめにした [モジュール]({% post_url 2017-07-22-クラス、オブジェクト指向、メソッド探索経路 %}#mix-in) の為のクラス

- 有用なメソッドが多数定義されている
- クラスのクラスであるClassクラスはこのModuleクラスを継承しているため、全てのクラスでこの有用なメソッドが利用できる

### モジュールを使った機能の追加

[Mix-in]({% post_url 2017-07-22-クラス、オブジェクト指向、メソッド探索経路 %}#mix-in) の辺りに書いてあります

### 定数に関するメソッド

| Module.constants        |
| レシーバ.constants      |
| レシーバ.const_defined? |
| レシーバ.const_get      |
| レシーバ.const_set      |
| レシーバ.remove_const   |
| レシーバ.ancestors      |
| レシーバ.const_missing  |

#### Module.constants メソッド

その時点で定義されている定数一覧を取得する

```ruby
Module.constants
=> [:Integer, :Float] # 大量の配列
```

#### constants メソッド

特定のクラスやモジュールで定義されている定数の一覧を取得する

```ruby
Regexp.constants
=> [:IGNORECASE, :EXTENDED, :MULTILINE, :FIXEDENCODING, :NOENCODING]
```

#### const_defined? メソッド

特定のクラスやモジュールで、指定した定数が定義されているかどうか

```ruby
Regexp.const_defined?(:IGNORECASE)
=> true

Regexp.const_defined?(:HAGE)
=> false
```

#### const_get メソッド

特定のクラスやモジュールの定数の値を取り出す

```ruby
Regexp.const_get(:IGNORECASE)
=> 1

Regexp::IGNORECASE
=> 1
```

#### const_set メソッド

特定のクラスやモジュールの定数の値を設定する

```ruby
Regexp.const_get(:HAGE)
=> NameError: uninitialized constant Regexp::HAGE

Regexp::HAGE
=> NameError: uninitialized constant Regexp::HAGE

Regexp.const_set(:HAGE, true)

Regexp.const_get(:HAGE)
=> true

Regexp::HAGE
=> true
```

#### remove_const メソッド

- 特定のクラスやモジュールの定数を取り除く
- privateメソッド

クラスメソッドから自らの定数を消させる

```ruby
class Moko
  HAGE = true

  class << self
    def remove
      remove_const(:HAGE)
    end
  end
end

Moko.const_get(:HAGE)
=> true

Moko::HAGE
=> true

Moko.remove
=> true

Moko.const_get(:HAGE)
=> NameError: uninitialized constant Moko::HAGE

Moko::HAGE
=> NameError: uninitialized constant Moko::HAGE
```

sendメソッドから無理やり定数を消す

```ruby
class Moko
  HAGE = true
end

Moko.const_get(:HAGE)
=> true

Moko::HAGE
=> true

Moko.send(:remove_const, :HAGE)
=> true

Moko.const_get(:HAGE)
=> NameError: uninitialized constant Moko::HAGE

Moko::HAGE
=> NameError: uninitialized constant Moko::HAGE
```

#### ancestors メソッド

- 継承チェーンを配列で返す
- 特異クラスは配列に含まれない
- includeしたモジュールも配列に含まれる
- extendしたモジュール（特異クラス）は配列に含まれない
- \[自分, 自分#included_module, 親, 親#included_module, Object, Kernel, BasicObject\] のような配列となる

```ruby
module OyajiModule1
end

module OyajiModule2
end

module MokoModule1
end

module MokoModule2
end

class Oyaji
  include OyajiModule1
  extend  OyajiModule2

  class << self
  end
end

class Moko < Oyaji
  include MokoModule1
  extend  MokoModule2

  class << self
  end
end

Moko.ancestors
=> [Moko, MokoModule1, Oyaji, OyajiModule1, Object, Kernel, BasicObject]
```

#### const_missing メソッド

- 継承チェーンを駆け上った末のBasicObjectでも定数が見つからない場合、呼び出し元のオブジェクトの#const_missingが呼び出される
- この#const_missingも継承チェーンを駆け上り、BasicObject#const_missingまで到達すると例外NameErrorが発生する
- 各クラスのconst_missingメソッドをオーバーライドする事で、継承チェーン全てをチェックしてもメソッドが見つからない場合の動作をフックすることができる

```ruby
class Moko
  class << self
    def const_missing(const_name)
      p const_name
      return 'hage-!'
    end
  end
end

Moko::Hoge
:Hoge
=> "hage-!"
```

### メソッドを設定する

オブジェクトのメソッドを調査し追加し削除等好き放題する

- 他のページにもちょっと書いてある
- [オブジェクトが持つインスタンスメソッドインスタンス変数]({% post_url 2017-07-22-クラス、オブジェクト指向、メソッド探索経路 %}#オブジェクトが持つインスタンスメソッドインスタンス変数を確認する)
- [メソッドの可視性]({% post_url 2017-07-22-クラス、オブジェクト指向、メソッド探索経路 %}#メソッドの可視性)
- [アクセッサメソッド]({% post_url 2017-07-22-クラス、オブジェクト指向、メソッド探索経路 %}#アクセッサメソッド)

| instance_methods | public_instance_methods | protected_instance_methods | private_instance_methods |
| public           | protected               | private                    |                          |
| attr_reader      | attr_writer             | attr_ccessor               | attr                     |
| alias_methods    |                         |                            |                          |















a
